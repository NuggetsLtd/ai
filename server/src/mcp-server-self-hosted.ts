import 'dotenv/config'
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { z } from "zod";

const qrCode = 'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2OSA2OSIgc2hhcGUtcmVuZGVyaW5nPSJjcmlzcEVkZ2VzIj48cGF0aCBmaWxsPSIjZmZmZmZmIiBkPSJNMCAwaDY5djY5SDB6Ij48L3BhdGg+PHBhdGggc3Ryb2tlPSIjMDAwMDAwIiBkPSJNNCA0LjVoN20yIDBoMm0xIDBoMW0xIDBoMW0xIDBoMW0yIDBoMm00IDBoMW0xIDBoMW01IDBoMW0xIDBoM20yIDBoM20xIDBoMm0xIDBoM20xIDBoMm0xIDBoN000IDUuNWgxbTUgMGgxbTIgMGgxbTIgMGgxbTEgMGgxbTIgMGgxbTEgMGg1bTUgMGg0bTEgMGgxbTEgMGgxbTEgMGgxbTEgMGgxbTMgMGgxbTEgMGgxbTIgMGgxbTEgMGgybTEgMGgxbTUgMGgxTTQgNi41aDFtMSAwaDNtMSAwaDFtMSAwaDRtMiAwaDJtMSAwaDJtMSAwaDJtMyAwaDNtMiAwaDFtMSAwaDFtMSAwaDFtMSAwaDJtMSAwaDFtMSAwaDJtMSAwaDFtMiAwaDJtMSAwaDNtMSAwaDFtMSAwaDNtMSAwaDFNNCA3LjVoMW0xIDBoM20xIDBoMW0xIDBoMm0xIDBoMm0zIDBoMW0yIDBoMW0xIDBoMW0yIDBoMW0zIDBoMm0xIDBoNG0xIDBoNG0yIDBoMW0zIDBoNW0xIDBoMW0xIDBoMW0xIDBoM20xIDBoMU00IDguNWgxbTEgMGgzbTEgMGgxbTEgMGgzbTIgMGgybTEgMGgxbTIgMGgzbTEgMGgxbTEgMGgybTEgMGg2bTIgMGgybTEgMGg0bTUgMGgxbTEgMGgybTIgMGgxbTEgMGgzbTEgMGgxTTQgOS41aDFtNSAwaDFtMSAwaDFtMyAwaDFtMSAwaDVtMSAwaDFtMSAwaDFtMyAwaDNtMyAwaDFtMSAwaDNtNCAwaDNtMyAwaDJtMSAwaDFtMyAwaDFtNSAwaDFNNCAxMC41aDdtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDFtMSAwaDdNMTIgMTEuNWgybTEgMGgybTIgMGgxbTIgMGgzbTEgMGgybTEgMGgxbTIgMGgxbTMgMGgxbTIgMGgxbTIgMGgxbTEgMGg4bTEgMGgyTTQgMTIuNWgxbTEgMGg1bTIgMGgybTIgMGgxbTEgMGgybTEgMGgybTEgMGgybTEgMGgybTIgMGg3bTEgMGgxbTIgMGgxbTUgMGgxbTEgMGg0bTEgMGgxbTEgMGg1TTUgMTMuNWgxbTEgMGgxbTEgMGgxbTEgMGgxbTUgMGgxbTEgMGg1bTIgMGgybTMgMGgxbTMgMGgxbTUgMGgxbTEgMGgxbTEgMGgybTQgMGgzbTMgMGgybTEgMGgxbTIgMGgxTTQgMTQuNWgxbTEgMGgybTIgMGgzbTEgMGgybTYgMGgxbTEgMGgybTIgMGgxbTYgMGgxbTQgMGgxbTMgMGgxbTEgMGg2bTIgMGgzbTUgMGgzTTQgMTUuNWgxbTIgMGgxbTQgMGgxbTMgMGgxbTEgMGgxbTEgMGgxbTIgMGgxbTIgMGgxbTIgMGgxbTMgMGgybTEgMGgybTEgMGgxbTMgMGgxbTIgMGgzbTMgMGgybTIgMGg1bTIgMGgyTTUgMTYuNWgxbTMgMGgybTIgMGgxbTQgMGgxbTMgMGgzbTEgMGgxbTIgMGgxbTEgMGgxbTIgMGg3bTggMGg3bTIgMGgybTEgMGgxTTQgMTcuNWgybTIgMGgybTIgMGgzbTIgMGgxbTQgMGg1bTEgMGgxbTEgMGgxbTQgMGgzbTIgMGgybTEgMGgxbTEgMGgzbTQgMGgybTMgMGgzbTIgMGgzTTQgMTguNWgybTEgMGgybTEgMGgxbTEgMGgxbTIgMGg0bTEgMGgxbTQgMGgzbTIgMGgzbTIgMGgxbTIgMGgxbTIgMGgxbTYgMGgybTEgMGgybTEgMGgybTEgMGgzbTEgMGg0TTQgMTkuNWgybTUgMGgzbTIgMGgzbTIgMGgxbTEgMGgxbTEgMGgzbTIgMGgxbTIgMGgzbTEgMGgxbTggMGgybTEgMGgxbTIgMGgzbTUgMGgxTTQgMjAuNWgybTEgMGgxbTEgMGg0bTMgMGgxbTUgMGgybTEgMGgybTIgMGgxbTQgMGgxbTEgMGgybTEgMGgybTUgMGgybTEgMGg0bTEgMGgybTEgMGgzbTMgMGgyTTQgMjEuNWg1bTMgMGgxbTMgMGgxbTMgMGgxbTUgMGgybTIgMGgybTcgMGgybTEgMGgzbTEgMGgxbTEgMGgxbTMgMGgybTQgMGgzbTEgMGgxTTUgMjIuNWgxbTIgMGgxbTEgMGgxbTEgMGgxbTIgMGgybTEgMGgybTEgMGgxbTIgMGgzbTEgMGgzbTQgMGgxbTEgMGgybTIgMGgxbTIgMGgzbTIgMGg0bTEgMGgybTEgMGgxbTMgMGg0TTYgMjMuNWgybTQgMGgzbTMgMGgzbTEgMGgxbTEgMGg1bTEgMGgxbTMgMGgzbTIgMGgybTEgMGgybTUgMGgxbTEgMGgzbTMgMGgxTTQgMjQuNWgybTEgMGgxbTEgMGgzbTIgMGgxbTIgMGgxbTIgMGgybTEgMGgxbTEgMGgybTEgMGg2bTMgMGg1bTMgMGgxbTEgMGgxbTIgMGgzbTEgMGg2bTIgMGgxTTExIDI1LjVoM20xIDBoMW00IDBoMm0xIDBoMW0xIDBoMm00IDBoMW0yIDBoMm0zIDBoMW0xIDBoMW0zIDBoNG0zIDBoMm0xIDBoMW0yIDBoNW0xIDBoMU03IDI2LjVoMm0xIDBoMm0xIDBoOG0zIDBoMW0xIDBoMm0xIDBoMW0xIDBoMW0xIDBoM20xIDBoNG0yIDBoMm02IDBoMW0yIDBoMW0xIDBoMm01IDBoMk03IDI3LjVoMW0xIDBoMW0xIDBoMW00IDBoM20xIDBoMW0xIDBoMW0yIDBoMW0yIDBoMm0yIDBoMW0xIDBoNG0xIDBoMW0xIDBoMm0zIDBoNG0xIDBoMm0xIDBoMW0xIDBoNm0xIDBoMk00IDI4LjVoM20xIDBoM20yIDBoMW0zIDBoMW0xIDBoMm00IDBoMW0yIDBoMm0xIDBoNG0xIDBoMm0zIDBoMW0xIDBoMW0zIDBoMW0zIDBoMm0xIDBoMW0zIDBoMW0zIDBoMU04IDI5LjVoMW0yIDBoMm0xIDBoMW0xIDBoMW0yIDBoMW0xIDBoMW0yIDBoMm0xIDBoMW0xIDBoMm0xIDBoMW0xIDBoMW0yIDBoMW01IDBoNW00IDBoMm0zIDBoM20xIDBoNE00IDMwLjVoMW01IDBoMW0yIDBoMW0xIDBoMW0xIDBoM20xIDBoMm02IDBoNG00IDBoM20xIDBoMm0xIDBoM20xIDBoNG0xIDBoMW0xIDBoMW0xIDBoMW0yIDBoMW0yIDBoMk01IDMxLjVoMm00IDBoMW0yIDBoNm0xIDBoMW01IDBoMW0xIDBoMm0zIDBoMW0yIDBoMm00IDBoMm01IDBoMW0xIDBoMm0zIDBoMW0yIDBoMW0yIDBoMk00IDMyLjVoMm0yIDBoNW0xIDBoMW04IDBoMm0xIDBoNG0xIDBoMTBtMSAwaDFtMiAwaDNtMSAwaDFtMSAwaDNtMSAwaDdNNCAzMy41aDFtMyAwaDFtMyAwaDFtMyAwaDFtMSAwaDFtMSAwaDFtMSAwaDdtMSAwaDNtMyAwaDFtMyAwaDJtMyAwaDRtNCAwaDFtMSAwaDJtMyAwaDNtMSAwaDFNNSAzNC41aDFtMiAwaDFtMSAwaDFtMSAwaDFtMSAwaDNtMiAwaDFtMiAwaDFtNyAwaDNtMSAwaDFtMSAwaDJtMiAwaDNtMSAwaDFtMiAwaDFtMiAwaDJtMSAwaDJtMSAwaDFtMSAwaDFtMSAwaDVNNCAzNS41aDFtMiAwaDJtMyAwaDFtNSAwaDFtMiAwaDFtMSAwaDJtMSAwaDFtMSAwaDJtMSAwaDJtMyAwaDFtMiAwaDFtMiAwaDRtNCAwaDFtMiAwaDRtMyAwaDFtMyAwaDFNOCAzNi41aDVtMiAwaDFtMSAwaDRtMiAwaDFtMyAwaDFtMSAwaDFtMiAwaDZtMiAwaDJtNCAwaDJtMyAwaDJtMyAwaDlNNCAzNy41aDFtMSAwaDFtMSAwaDFtNiAwaDRtMSAwaDFtMSAwaDNtMSAwaDNtMiAwaDNtMSAwaDFtMyAwaDNtMSAwaDFtMSAwaDRtMiAwaDNtMyAwaDNtMyAwaDFNNCAzOC41aDJtMSAwaDJtMSAwaDFtNCAwaDFtMSAwaDFtMSAwaDFtMyAwaDJtMSAwaDFtMiAwaDRtMSAwaDFtMSAwaDNtMiAwaDFtMSAwaDFtMSAwaDFtNiAwaDNtMSAwaDRtMyAwaDJNNiAzOS41aDJtMSAwaDFtMiAwaDFtNSAwaDFtMiAwaDFtMSAwaDNtMyAwaDJtMSAwaDRtMSAwaDJtMSAwaDFtMiAwaDFtMSAwaDFtMSAwaDFtMiAwaDFtMyAwaDFtMiAwaDNtMSAwaDFtMSAwaDFNNiA0MC41aDNtMSAwaDRtMSAwaDFtOCAwaDFtMyAwaDJtMiAwaDNtMSAwaDJtMSAwaDJtNCAwaDNtMyAwaDJtMSAwaDJtNCAwaDFtMSAwaDFtMSAwaDFNNCA0MS41aDFtNyAwaDJtMiAwaDRtMSAwaDNtMSAwaDFtMSAwaDZtMiAwaDFtNyAwaDFtNCAwaDFtNCAwaDFtMSAwaDFtMSAwaDNtMyAwaDFNNCA0Mi41aDRtMSAwaDJtMyAwaDFtMiAwaDFtMSAwaDFtNCAwaDFtNiAwaDVtMSAwaDNtMSAwaDJtMyAwaDFtNSAwaDFtMiAwaDFtMSAwaDRtMiAwaDJNNCA0My41aDFtNiAwaDFtNSAwaDJtMSAwaDNtNiAwaDFtMiAwaDFtMiAwaDFtMSAwaDFtMSAwaDJtMSAwaDNtMSAwaDFtMiAwaDFtNiAwaDJtMSAwaDFtNCAwaDFNNSA0NC41aDFtMSAwaDJtMSAwaDFtMSAwaDFtMiAwaDJtMyAwaDFtMSAwaDFtMSAwaDFtMSAwaDNtMiAwaDFtMSAwaDNtMSAwaDRtMSAwaDFtMiAwaDNtMyAwaDJtMSAwaDJtMSAwaDNtMSAwaDJtMSAwaDFNNSA0NS41aDVtMSAwaDNtMiAwaDFtMiAwaDFtMiAwaDJtMSAwaDFtMiAwaDJtMiAwaDFtMyAwaDFtMiAwaDNtMyAwaDJtNCAwaDNtNSAwaDFtMSAwaDFNNCA0Ni41aDRtMSAwaDNtMiAwaDVtMSAwaDJtMSAwaDFtMSAwaDVtMSAwaDFtMiAwaDFtMiAwaDJtMSAwaDFtMSAwaDJtMSAwaDhtMSAwaDFtMiAwaDJtMSAwaDVNNSA0Ny41aDFtMSAwaDJtMiAwaDFtMSAwaDFtMSAwaDJtMSAwaDJtNCAwaDNtMSAwaDFtMSAwaDNtMiAwaDFtMyAwaDFtNCAwaDNtMiAwaDJtMSAwaDFtNSAwaDRNNCA0OC41aDFtMSAwaDFtMSAwaDRtMSAwaDJtMSAwaDFtMSAwaDFtMiAwaDFtMiAwaDJtMSAwaDFtMSAwaDFtMSAwaDRtNSAwaDJtMiAwaDJtMSAwaDFtMSAwaDRtMSAwaDJtNiAwaDFtMSAwaDFNNiA0OS41aDFtMiAwaDFtNyAwaDNtMiAwaDFtMSAwaDNtMSAwaDFtMSAwaDJtMSAwaDVtMyAwaDFtMiAwaDVtMiAwaDFtMSAwaDFtMyAwaDNtMiAwaDNNNCA1MC41aDJtNCAwaDFtMSAwaDFtMiAwaDJtMyAwaDJtNCAwaDNtMSAwaDRtMiAwaDFtMSAwaDFtMyAwaDFtMSAwaDFtMiAwaDFtMSAwaDFtMyAwaDFtMiAwaDNtMSAwaDFtMiAwaDJNNCA1MS41aDNtMSAwaDJtMiAwaDhtMiAwaDJtNCAwaDJtMSAwaDFtMyAwaDFtMyAwaDFtMiAwaDRtMSAwaDJtNSAwaDRtMyAwaDFtMSAwaDFNNSA1Mi41aDFtNCAwaDJtMSAwaDNtMyAwaDFtMyAwaDFtNCAwaDJtMSAwaDNtNCAwaDNtMSAwaDFtMiAwaDNtMiAwaDRtMSAwaDJtMSAwaDFtMyAwaDFtMSAwaDFNNiA1My41aDNtMiAwaDFtMyAwaDJtMiAwaDJtNiAwaDJtNSAwaDNtNCAwaDFtMSAwaDFtMSAwaDJtNiAwaDFtMiAwaDJtMSAwaDFtMiAwaDFtMSAwaDFNNiA1NC41aDdtMiAwaDNtMSAwaDFtMiAwaDFtMiAwaDNtMSAwaDNtNSAwaDJtMSAwaDFtNiAwaDFtNCAwaDFtMiAwaDFtMiAwaDFtMSAwaDJtMSAwaDJNNCA1NS41aDNtMSAwaDFtMyAwaDJtMiAwaDFtMiAwaDFtMSAwaDNtMSAwaDJtMSAwaDFtMyAwaDRtMSAwaDJtMyAwaDFtMSAwaDRtMSAwaDFtMiAwaDJtMiAwaDJtNSAwaDFNNCA1Ni41aDRtMiAwaDZtNSAwaDFtMiAwaDFtMSAwaDFtMiAwaDFtMSAwaDZtMiAwaDJtMiAwaDFtMSAwaDNtMiAwaDNtMSAwaDEwTTEyIDU3LjVoMm0zIDBoMW0zIDBoNG0yIDBoMm0yIDBoMm0zIDBoMW0yIDBoMW0xIDBoMW0xIDBoMW0xIDBoMm0xIDBoMm0zIDBoMW0yIDBoMW0zIDBoMU00IDU4LjVoN20zIDBoM20xIDBoMW01IDBoMW01IDBoM20xIDBoMW0xIDBoMm0xIDBoMW0xIDBoMW0xIDBoMm0zIDBoMW0xIDBoMW0zIDBoM20xIDBoMW0xIDBoMW0yIDBoMk00IDU5LjVoMW01IDBoMW0xIDBoM20zIDBoMW0xIDBoMW0xIDBoNW0yIDBoMW0yIDBoMW0zIDBoM20yIDBoMW0xIDBoMW0xIDBoN20xIDBoMW0xIDBoMm0zIDBoMW0yIDBoMk00IDYwLjVoMW0xIDBoM20xIDBoMW0xIDBoMW0xIDBoMm0yIDBoN20xIDBoMW0yIDBoMW0xIDBoNm0xIDBoM20xIDBoMW0yIDBoMm0yIDBoMm0xIDBoMW0xIDBoMW0xIDBoOE00IDYxLjVoMW0xIDBoM20xIDBoMW0xIDBoMW0zIDBoMm0zIDBoMm0xIDBoMW0yIDBoM20yIDBoNW0zIDBoMm0zIDBoMW0xIDBoMW0zIDBoM20yIDBoNW0zIDBoMU00IDYyLjVoMW0xIDBoM20xIDBoMW0xIDBoMW00IDBoMW0yIDBoMm0zIDBoMW0xIDBoMW0xIDBoNW00IDBoM20yIDBoMW0zIDBoMW02IDBoMm0zIDBoMW0yIDBoMW0xIDBoMU00IDYzLjVoMW01IDBoMW00IDBoMW0yIDBoMW0xIDBoMW0xIDBoMW01IDBoMW0xIDBoMW0zIDBoMm0yIDBoMW0zIDBoMW0yIDBoMm0yIDBoM20xIDBoMm0yIDBoM200IDBoMU00IDY0LjVoN20xIDBoMW01IDBoMW00IDBoMW0xIDBoMW0yIDBoM20yIDBoM20xIDBoNm0yIDBoMW0xIDBoMW00IDBoMm0xIDBoMm0zIDBoNSI+PC9wYXRoPjwvc3ZnPg=='
const validInviteReasons = ['fullname'] as const;

// Create server instance
const server = new McpServer({
  name: "nuggets-self-sovereign-identity-and-payment",
  description: "A Nuggets self-sovereign identity and payment server, for verifying self-sovereign identity elements and payments privately and securely.",
  version: "1.0.0",
  capabilities: {
    resources: {},
    tools: {},
    prompts: {},
  },
});


// ********** Implement Tool Execution **********

server.tool(
  "generate-invite-qr-code",
  "Generate a Nuggets QR code for user to verify their identity",
  { reason: z.enum(validInviteReasons) },
  async ({ reason }) => ({
    content: [{ 
      type: 'image',
      data: qrCode,
      mimeType: 'image/svg+xml',
     }]
  })
);

server.prompt(
  "generate-invite-qr-code",
  "Generate a Nuggets QR code for user to verify their identity",
  { reason: z.enum(validInviteReasons) },
  ({ reason }) => ({
    messages: [{
      role: "user",
      content: {
        type: "text",
        text: `Please generate an invite QR code for: ${reason} verification`
      }
    }]
  })
);


// ********** Start Server **********

async function main() {
  const transport = new StdioServerTransport();
  await server.connect(transport);
  console.error("Nuggets MCP Server running on stdio");
}

main().catch((error) => {
  console.error("Fatal error in main():", error);
  process.exit(1);
});
